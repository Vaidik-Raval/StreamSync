<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StreamSync Room</title>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://www.youtube.com/iframe_api"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'Inter', sans-serif;
      box-sizing: border-box;
    }
    
    body {
      background: #0a0a0f;
      background-image: 
        radial-gradient(circle at 25% 25%, #1a1a2e 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, #16213e 0%, transparent 50%);
      overflow-x: hidden;
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
    }
    
    .primary-button {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
    }
    
    .primary-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
    }
    
    .secondary-button {
      background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
    }
    
    .secondary-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
    }
    
    .danger-button {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
    }
    
    .danger-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
    }
    
    .input-dark {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    
    .input-dark:focus {
      background: rgba(255, 255, 255, 0.08);
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }
    
    .chat-message {
      background: rgba(255, 255, 255, 0.05);
      border-left: 4px solid #6366f1;
      backdrop-filter: blur(10px);
      transition: all 0.2s ease;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    
    .chat-message:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateX(4px);
    }
    
    .queue-item {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    
    .queue-item:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(99, 102, 241, 0.5);
      transform: translateX(4px);
    }
    
    .queue-item.current {
      border-color: #f59e0b;
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(249, 115, 22, 0.1) 100%);
    }
    
    .participant-item {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.2s ease;
    }
    
    .participant-item:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(16, 185, 129, 0.5);
    }
    
    .scrollbar-custom::-webkit-scrollbar {
      width: 6px;
    }
    
    .scrollbar-custom::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
    }
    
    .scrollbar-custom::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
    }
    
    .scrollbar-custom::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .gradient-text {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .chat-input-container {
      display: flex;
      gap: 0.75rem;
      flex-wrap: nowrap;
      width: 100%;
    }
    
    .chat-input {
      flex: 1;
      min-width: 0;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }
    
    .chat-send-btn {
      flex-shrink: 0;
      white-space: nowrap;
    }
    
    .chat-message-text {
      word-wrap: break-word;
      overflow-wrap: break-word;
      white-space: pre-wrap;
      max-width: 100%;
    }
    
    @media (max-width: 640px) {
      .chat-input-container {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .chat-send-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body class="min-h-screen text-white">
  
  <div id="joinPrompt" class="min-h-screen flex items-center justify-center p-6">
    <!-- Back to Home Button -->
    <a href="/" class="fixed top-6 left-6 z-10 flex items-center gap-2 text-gray-300 hover:text-white transition-colors duration-200">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
      <span class="text-sm font-medium hidden sm:inline">Back to Home</span>
    </a>
    
    <div class="glass-card p-10 rounded-3xl text-center max-w-md w-full">
      <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-3xl mb-8">
        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
        </svg>
      </div>
      <h2 class="text-3xl font-bold gradient-text mb-6">Join StreamSync</h2>
      <p class="text-gray-300 mb-8">Enter your name to join the synchronized viewing experience</p>
      <input 
        type="text" 
        id="username" 
        class="input-dark text-white p-4 mb-6 rounded-2xl w-full outline-none placeholder-gray-400" 
        placeholder="Enter your name" 
      />
      <button 
        class="primary-button text-white px-8 py-4 rounded-2xl font-semibold w-full" 
        onclick="joinRoom()"
      >
        Join Room
      </button>
    </div>
  </div>

  <div id="mainInterface" class="hidden min-h-screen p-4 sm:p-6 lg:p-8">
    <!-- Navigation Header -->
    <div class="glass-card p-4 rounded-2xl mb-4 sm:mb-6">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div class="flex items-center gap-4">
          <a href="/" class="flex items-center gap-2 text-gray-300 hover:text-white transition-colors duration-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            <span class="text-sm font-medium">Back to Home</span>
          </a>
          <div class="w-px h-6 bg-gray-600"></div>
          <div class="text-sm text-gray-400">
            <span class="hidden sm:inline">Room ID: </span><span class="font-mono text-indigo-400" id="displayRoomId"></span>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <button 
            onclick="shareRoom()" 
            class="flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors duration-200 text-sm font-medium"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
            </svg>
            <span class="hidden sm:inline">Share Room</span>
            <span class="sm:hidden">Share</span>
          </button>
          <button 
            onclick="copyRoomLink()" 
            class="flex items-center gap-2 px-4 py-2 secondary-button text-white rounded-lg transition-colors duration-200 text-sm font-medium"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
            </svg>
            <span class="hidden sm:inline">Copy Link</span>
            <span class="sm:hidden">Copy</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Controls Header -->
    <div class="glass-card p-4 sm:p-6 rounded-2xl mb-6 sm:mb-8">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <h1 class="text-2xl sm:text-3xl font-bold gradient-text mb-2">StreamSync Room</h1>
          <p class="text-gray-400 text-sm sm:text-base" id="roomInfo">Synchronized viewing experience</p>
        </div>
        <div class="flex flex-col sm:flex-row gap-3">
          <input 
            type="text" 
            id="youtubeURL" 
            class="input-dark text-white p-3 rounded-xl outline-none placeholder-gray-400 w-full sm:w-72" 
            placeholder="YouTube URL" 
          />
          <div class="flex gap-2">
            <button 
              class="primary-button text-white px-4 sm:px-6 py-3 rounded-xl font-semibold flex-1 sm:flex-none text-sm sm:text-base" 
              onclick="addToQueue()"
            >
              Add to Queue
            </button>
            <button 
              class="danger-button text-white px-4 sm:px-6 py-3 rounded-xl font-semibold flex-1 sm:flex-none text-sm sm:text-base" 
              onclick="skipVideo()"
            >
              Skip Video
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 xl:grid-cols-4 gap-6 sm:gap-8">
      <!-- Video Player -->
      <div class="xl:col-span-2">
        <div class="glass-card p-4 sm:p-6 rounded-2xl">
          <div id="player" class="w-full aspect-video bg-gray-900 rounded-xl overflow-hidden"></div>
          <div class="mt-4 sm:mt-6 text-center">
            <h3 class="text-xl sm:text-2xl font-semibold text-white mb-2" id="currentVideoTitle">No video loaded</h3>
            <p class="text-gray-400 text-sm sm:text-base" id="videoProgress">Ready to watch</p>
          </div>
        </div>
      </div>

      <!-- Queue -->
      <div class="glass-card p-4 sm:p-6 rounded-2xl">
        <div class="flex items-center gap-3 mb-4 sm:mb-6">
          <div class="w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
            </svg>
          </div>
          <h3 class="text-lg sm:text-xl font-semibold text-white">Queue</h3>
        </div>
        <div id="queue-list" class="space-y-3 max-h-60 sm:max-h-80 overflow-y-auto scrollbar-custom">
          <div class="text-gray-400 text-center py-8 sm:py-12 text-sm sm:text-base">Queue is empty</div>
        </div>
      </div>

      <!-- Chat & Participants -->
      <div class="space-y-4 sm:space-y-6">
        <!-- Participants -->
        <div class="glass-card p-4 sm:p-6 rounded-2xl">
          <div class="flex items-center gap-3 mb-4 sm:mb-6">
            <div class="w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-xl flex items-center justify-center">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
              </svg>
            </div>
            <h3 class="text-lg sm:text-xl font-semibold text-white">Participants</h3>
          </div>
          <ul id="participant-list" class="space-y-2 max-h-24 sm:max-h-32 overflow-y-auto scrollbar-custom">
            <li class="text-gray-400 text-sm sm:text-base">Loading...</li>
          </ul>
        </div>

        <!-- Chat -->
        <div class="glass-card p-4 sm:p-6 rounded-2xl">
          <div class="flex items-center gap-3 mb-4 sm:mb-6">
            <div class="w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-xl flex items-center justify-center">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
              </svg>
            </div>
            <h3 class="text-lg sm:text-xl font-semibold text-white">Chat</h3>
          </div>
          <div id="chat-box" class="space-y-3 max-h-36 sm:max-h-48 overflow-y-auto scrollbar-custom mb-4">
            <div class="text-gray-400 text-center py-6 sm:py-8 text-sm sm:text-base">Chat is ready</div>
          </div>
          <div class="chat-input-container">
            <input 
              type="text" 
              id="chatInput" 
              class="chat-input input-dark text-white p-3 rounded-xl outline-none placeholder-gray-400 text-sm sm:text-base" 
              placeholder="Type a message..." 
            />
            <button 
              class="chat-send-btn primary-button text-white px-4 sm:px-6 py-3 rounded-xl font-semibold text-sm sm:text-base" 
              onclick="sendMessage()"
            >
              Send
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const socket = io();
    const roomId = window.location.pathname.split('/').pop();
    let player, username = '', isHost = false;
    let videoQueue = [];
    let currentVideoIndex = -1;

    function joinRoom() {
      username = document.getElementById('username').value.trim();
      if (!username) return alert('Please enter a name');
      isHost = location.search.includes('host=true');

      document.getElementById('joinPrompt').classList.add('hidden');
      document.getElementById('mainInterface').classList.remove('hidden');
      
      // Update room info and display room ID
      document.getElementById('roomInfo').textContent = `Room: ${roomId}${isHost ? ' (Host)' : ''}`;
      document.getElementById('displayRoomId').textContent = roomId;

      socket.emit('join-room', { roomId, username, isHost });
    }

    function shareRoom() {
      const roomUrl = `${window.location.origin}/room/${roomId}`;
      
      if (navigator.share) {
        // Use native sharing if available (mobile devices)
        navigator.share({
          title: 'Join my StreamSync room!',
          text: `Join me for a synchronized video viewing session on StreamSync`,
          url: roomUrl
        }).catch(err => console.log('Error sharing:', err));
      } else {
        // Fallback: copy to clipboard and show notification
        copyRoomLink();
      }
    }

    function copyRoomLink() {
      const roomUrl = `${window.location.origin}/room/${roomId}`;
      
      navigator.clipboard.writeText(roomUrl).then(() => {
        // Show success notification
        showNotification('Room link copied to clipboard!', 'success');
      }).catch(err => {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = roomUrl;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showNotification('Room link copied to clipboard!', 'success');
      });
    }

    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 z-50 p-4 rounded-xl text-white font-medium transition-all duration-300 transform translate-x-full`;
      
      if (type === 'success') {
        notification.classList.add('bg-emerald-600');
      } else if (type === 'error') {
        notification.classList.add('bg-red-600');
      } else {
        notification.classList.add('bg-indigo-600');
      }
      
      notification.innerHTML = `
        <div class="flex items-center gap-3">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          <span>${message}</span>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Animate in
      setTimeout(() => {
        notification.classList.remove('translate-x-full');
      }, 100);
      
      // Animate out and remove
      setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '360',
        width: '640',
        videoId: '',
        events: {
          onReady: onPlayerReady,
          onStateChange: onPlayerStateChange
        }
      });
    }

    function onPlayerReady() {
      socket.emit('player-ready', roomId);
    }

    function addToQueue() {
      if (!isHost) return alert('Only the host can manage the queue');
      const url = document.getElementById('youtubeURL').value.trim();
      if (!url) return alert('Please enter a YouTube URL');
      
      try {
        const videoId = new URL(url).searchParams.get("v");
        if (!videoId) throw new Error('Invalid YouTube URL');
        
        socket.emit('queue-action', { 
          type: 'add', 
          videoId,
          title: `Video ${videoQueue.length + 1}`
        });
        
        document.getElementById('youtubeURL').value = '';
      } catch (error) {
        alert('Please enter a valid YouTube URL');
      }
    }

    function skipVideo() {
      if (!isHost) return alert('Only the host can skip videos');
      socket.emit('queue-action', { type: 'skip' });
    }

    function playFromQueue(index) {
      if (!isHost) return alert('Only the host can manage playback');
      socket.emit('queue-action', { type: 'play', index });
    }

    function removeFromQueue(index) {
      if (!isHost) return alert('Only the host can manage the queue');
      socket.emit('queue-action', { type: 'remove', index });
    }

    function updateQueueDisplay() {
      const queueList = document.getElementById('queue-list');
      if (videoQueue.length === 0) {
        queueList.innerHTML = '<div class="text-gray-400 text-center py-12">Queue is empty</div>';
        return;
      }

      queueList.innerHTML = videoQueue.map((video, index) => `
        <div class="queue-item p-4 rounded-xl ${index === currentVideoIndex ? 'current' : ''}" data-index="${index}">
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <div class="font-semibold text-sm ${index === currentVideoIndex ? 'text-amber-400' : 'text-white'} mb-1">
                ${video.title}
              </div>
              <div class="text-xs text-gray-400">
                ${index === currentVideoIndex ? 'ðŸŽµ Now Playing' : `#${index + 1} in queue`}
              </div>
            </div>
            <div class="flex gap-2 ml-3">
              ${isHost ? `
                <button onclick="playFromQueue(${index})" class="text-indigo-400 hover:text-indigo-300 p-2 rounded-lg hover:bg-white/5 transition-all duration-200">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1.5a2.5 2.5 0 110 5H9m-4-5L9 10m-4 5h1.5a2.5 2.5 0 100-5H5m4-5L9 10m0 0l5 5"></path>
                  </svg>
                </button>
                <button onclick="removeFromQueue(${index})" class="text-red-400 hover:text-red-300 p-2 rounded-lg hover:bg-white/5 transition-all duration-200">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                </button>
              ` : ''}
            </div>
          </div>
        </div>
      `).join('');
    }

    function onPlayerStateChange(event) {
      if (!isHost) return;
      
      if (event.data === YT.PlayerState.ENDED) {
        socket.emit('queue-action', { type: 'next' });
      } else if (event.data === YT.PlayerState.PLAYING) {
        const currentTime = player.getCurrentTime();
        socket.emit('video-action', { type: 'play', currentTime });
      } else if (event.data === YT.PlayerState.PAUSED) {
        const currentTime = player.getCurrentTime();
        socket.emit('video-action', { type: 'pause', currentTime });
      }
    }

    // Sync current time every 5 seconds
    setInterval(() => {
      if (isHost && player && player.getPlayerState() === YT.PlayerState.PLAYING) {
        const currentTime = player.getCurrentTime();
        socket.emit('video-action', { type: 'seek', currentTime });
      }
    }, 5000);

    socket.on('sync-video', (data) => {
      if (!player || typeof player.loadVideoById !== 'function') return;

      if (data.type === 'load') {
        player.loadVideoById(data.videoId);
        document.getElementById('currentVideoTitle').textContent = data.title || 'Loading...';
      } else if (data.type === 'play') {
        player.playVideo();
        if (data.currentTime) player.seekTo(data.currentTime, true);
      } else if (data.type === 'pause') {
        player.pauseVideo();
        if (data.currentTime) player.seekTo(data.currentTime, true);
      } else if (data.type === 'seek') {
        player.seekTo(data.currentTime, true);
      }
    });

    socket.on('queue-update', (data) => {
      videoQueue = data.queue;
      currentVideoIndex = data.currentIndex;
      updateQueueDisplay();
      
      if (data.currentVideo) {
        document.getElementById('currentVideoTitle').textContent = data.currentVideo.title;
      }
    });

    function sendMessage() {
      const msg = document.getElementById('chatInput').value.trim();
      if (msg) {
        socket.emit('chat-message', { roomId, username, message: msg });
        document.getElementById('chatInput').value = '';
      }
    }

    // Enter key for chat
    document.getElementById('chatInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });

    socket.on('chat-message', (data) => {
      const chatBox = document.getElementById('chat-box');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'chat-message p-4 rounded-xl';
      messageDiv.innerHTML = `
        <div class="text-indigo-400 text-xs font-semibold mb-2">${data.username}</div>
        <div class="chat-message-text text-white text-sm leading-relaxed">${data.message}</div>
      `;
      chatBox.appendChild(messageDiv);
      chatBox.scrollTop = chatBox.scrollHeight;
    });

    socket.on('update-participants', (participants) => {
      const list = document.getElementById('participant-list');
      list.innerHTML = participants.map(p => `
        <li class="participant-item p-3 rounded-xl flex items-center gap-3">
          <span class="w-2 h-2 bg-emerald-400 rounded-full"></span>
          <span class="text-white font-medium">${p}</span>
        </li>
      `).join('');
    });

    // Update video progress display
    setInterval(() => {
      if (player && player.getCurrentTime && player.getDuration) {
        try {
          const current = player.getCurrentTime();
          const duration = player.getDuration();
          if (current && duration) {
            const progress = Math.floor((current / duration) * 100);
            document.getElementById('videoProgress').textContent = 
              `${Math.floor(current / 60)}:${String(Math.floor(current % 60)).padStart(2, '0')} / ${Math.floor(duration / 60)}:${String(Math.floor(duration % 60)).padStart(2, '0')} (${progress}%)`;
          }
        } catch (e) {
          // Ignore errors when player isn't ready
        }
      }
    }, 1000);
  </script>
</body>
</html>